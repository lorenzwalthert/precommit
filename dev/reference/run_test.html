<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Run a test — run_test • precommit</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Run a test — run_test"><meta property="og:description" content="Tests for the executables used as pre-commit hooks via entrypoint in
.pre-commit-config.yaml. Set's the env variable R_PRECOMMIT_HOOK_ENV to
when running."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">precommit</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.3.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/precommit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/why-use-hooks.html">Why is this useful?</a>
    </li>
    <li>
      <a href="../articles/available-hooks.html">Available Hooks</a>
    </li>
    <li>
      <a href="../articles/ci.html">Continuous Integration</a>
    </li>
    <li>
      <a href="../articles/FAQ.html">FAQ</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More articles...</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lorenzwalthert/precommit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>

    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run a test</h1>
    <small class="dont-index">Source: <a href="https://github.com/lorenzwalthert/precommit/blob/main/R/testing.R" class="external-link"><code>R/testing.R</code></a></small>
    <div class="hidden name"><code>run_test.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Tests for the executables used as pre-commit hooks via <code>entrypoint</code> in
<code>.pre-commit-config.yaml</code>. Set's the env variable <code>R_PRECOMMIT_HOOK_ENV</code> to
when running.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_test</span><span class="op">(</span></span>
<span>  <span class="va">hook_name</span>,</span>
<span>  file_name <span class="op">=</span> <span class="va">hook_name</span>,</span>
<span>  suffix <span class="op">=</span> <span class="st">".R"</span>,</span>
<span>  std_err <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  std_out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cmd_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  artifacts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  file_transformer <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">files</span><span class="op">)</span> <span class="va">files</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  expect_success <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">std_err</span><span class="op">)</span>,</span>
<span>  read_only <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-hook-name">hook_name<a class="anchor" aria-label="anchor" href="#arg-hook-name"></a></dt>
<dd><p>The name of the hook in <code>inst/hooks/exported/</code>, without
file extension.</p></dd>


<dt id="arg-file-name">file_name<a class="anchor" aria-label="anchor" href="#arg-file-name"></a></dt>
<dd><p>The file to test in <code>tests/in</code> (without extension). Can be
a named vector of length one where the name is the target location relative
to the temporary location and the value is the source of the file.</p></dd>


<dt id="arg-suffix">suffix<a class="anchor" aria-label="anchor" href="#arg-suffix"></a></dt>
<dd><p>The suffix of <code>file_name</code>.</p></dd>


<dt id="arg-std-err">std_err<a class="anchor" aria-label="anchor" href="#arg-std-err"></a></dt>
<dd><p>An expected error message. If no error is expected, this
can be <code>NULL</code>. In that case, the <code>comparator</code> is applied.</p></dd>


<dt id="arg-std-out">std_out<a class="anchor" aria-label="anchor" href="#arg-std-out"></a></dt>
<dd><p>The expected stdout message. If <code>NULL</code>, this check is omitted.</p></dd>


<dt id="arg-cmd-args">cmd_args<a class="anchor" aria-label="anchor" href="#arg-cmd-args"></a></dt>
<dd><p>More arguments passed to the file. Pre-commit handles it as
described <a href="https://pre-commit.com/#arguments-pattern-in-hooks" class="external-link">here</a>.</p></dd>


<dt id="arg-artifacts">artifacts<a class="anchor" aria-label="anchor" href="#arg-artifacts"></a></dt>
<dd><p>Path with artifact files to copy to the temp directory root where
the test is run. If you don't target the root, this can be a named vector
of length one where the name is the target location relative to the
temporary location and the value is the source of the file.</p></dd>


<dt id="arg-file-transformer">file_transformer<a class="anchor" aria-label="anchor" href="#arg-file-transformer"></a></dt>
<dd><p>A function that takes the file names as input and is
ran right before the hook script is invoked, returning the path to the
files, potentially modified (if renamed). This can be useful if you need to
make in-place modifications to the file, e.g. to test hooks that operate on
<code>.Rprofile</code>. You can't have different names for different tests on that
file because it must be called <code>.Rprofile</code> all the time. And R CMD check
seems to remove hidden files, so we must also rename it. The transformation
is also applied to a temp copy of the reference file before a comparison is
made.</p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>The environment variables to set with <code><a href="https://rdrr.io/r/base/system2.html" class="external-link">base::system2()</a></code>.</p></dd>


<dt id="arg-expect-success">expect_success<a class="anchor" aria-label="anchor" href="#arg-expect-success"></a></dt>
<dd><p>Whether or not an exit code 0 is expected. This can
be derived from <code>std_err</code>, but sometimes, non-empty stderr does not mean
error, but just a message.</p></dd>


<dt id="arg-read-only">read_only<a class="anchor" aria-label="anchor" href="#arg-read-only"></a></dt>
<dd><p>If <code>TRUE</code>, then assert that no new files were created.
Additionally, if <code>artifacts</code> are not <code>NULL</code>, then assert that hook did not
modify the artifacts.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Two potential outcomes of a hooks are pass or fail. This is reflected on the
level of the executable: Fail means the executable fails or the file is
changed. Pass means the executable succeeds and the file is unchanged.
We check if the executable passes as follows:</p><ul><li><p>If we expect success (by setting <code>std_err</code> to <code>NULL</code>), we make sure
nothing was written to sterr and the file content does not change.</p></li>
<li><p>If we expect failure, it can be due to changed file or due to failed
executable. To check for failed executable, we set <code>std_err</code> to
the message we expect. To check changed file content, we set <code>std_err</code> to
<code>NA</code>.</p></li>
</ul></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://lorenzwalthert.com" class="external-link">Lorenz Walthert</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: 'ae5363c86f48f4117b4f2b9beaefa28f',
    indexName: 'lorenzwalthert_precommit',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

